{% macro render_onboarding(current_step, classroom=None) %}
{#
온보딩 플로우 컴포넌트
current_step: 1=학급생성, 2=학생추가, 3=응답수집, 4=분석실행
#}
<div class="glass-card fade-in">
    <div class="text-center mb-8">
        <div class="w-16 h-16 bg-gradient-to-br from-primary-400 to-secondary-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
            </svg>
        </div>
        <h2 class="text-2xl font-bold text-white mb-2">{{ _('학급 관계 분석 시작하기') }}</h2>
        <p class="text-white/60">{{ _('아래 단계를 따라 학급 관계 분석을 진행해주세요') }}</p>
    </div>

    <!-- 진행 단계 -->
    <div class="space-y-4">
        <!-- 단계 1: 학급 생성 -->
        <div class="flex items-center gap-4 p-4 rounded-xl {{ 'bg-green-500/20 border border-green-500/30' if current_step > 1 else ('bg-primary-500/20 border border-primary-500/30' if current_step == 1 else 'bg-white/5') }}">
            <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 {{ 'bg-green-500' if current_step > 1 else ('bg-primary-500' if current_step == 1 else 'bg-white/20') }}">
                {% if current_step > 1 %}
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                {% else %}
                <span class="text-white font-bold">1</span>
                {% endif %}
            </div>
            <div class="flex-grow">
                <h3 class="font-medium text-white">{{ _('학급 생성') }}</h3>
                <p class="text-sm {{ 'text-green-300/80' if current_step > 1 else 'text-white/50' }}">
                    {% if current_step > 1 %}
                    ✓ {{ classroom.name if classroom else _('학급 생성 완료') }}
                    {% else %}
                    {{ _('새 학급을 만들어 시작하세요') }}
                    {% endif %}
                </p>
            </div>
            {% if current_step == 1 %}
            <button onclick="openCreateModal()" class="glass-btn glass-btn-primary text-sm">
                {{ _('학급 만들기') }}
            </button>
            {% endif %}
        </div>

        <!-- 단계 2: 학생 추가 -->
        <div class="flex items-center gap-4 p-4 rounded-xl {{ 'bg-green-500/20 border border-green-500/30' if current_step > 2 else ('bg-primary-500/20 border border-primary-500/30' if current_step == 2 else 'bg-white/5') }}">
            <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 {{ 'bg-green-500' if current_step > 2 else ('bg-primary-500' if current_step == 2 else 'bg-white/20') }}">
                {% if current_step > 2 %}
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                {% else %}
                <span class="text-white font-bold">2</span>
                {% endif %}
            </div>
            <div class="flex-grow">
                <h3 class="font-medium text-white">{{ _('학생 명단 등록') }}</h3>
                <p class="text-sm {{ 'text-green-300/80' if current_step > 2 else 'text-white/50' }}">
                    {% if current_step > 2 %}
                    ✓ {{ classroom.students.count() if classroom else 0 }}{{ _('명 등록 완료') }}
                    {% elif current_step == 2 %}
                    {{ _('학생 명단을 업로드하거나 직접 추가하세요') }}
                    {% else %}
                    {{ _('학급 생성 후 진행 가능') }}
                    {% endif %}
                </p>
            </div>
            {% if current_step == 2 and classroom %}
            <button onclick="openClassroom({{ classroom.id }})" class="glass-btn glass-btn-primary text-sm">
                {{ _('학생 추가') }}
            </button>
            {% endif %}
        </div>

        <!-- 단계 3: 설문 진행 -->
        <div class="flex items-center gap-4 p-4 rounded-xl {{ 'bg-green-500/20 border border-green-500/30' if current_step > 3 else ('bg-primary-500/20 border border-primary-500/30' if current_step == 3 else 'bg-white/5') }}">
            <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 {{ 'bg-green-500' if current_step > 3 else ('bg-primary-500' if current_step == 3 else 'bg-white/20') }}">
                {% if current_step > 3 %}
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                {% else %}
                <span class="text-white font-bold">3</span>
                {% endif %}
            </div>
            <div class="flex-grow">
                <h3 class="font-medium text-white">{{ _('설문 응답 수집') }}</h3>
                <p class="text-sm {{ 'text-green-300/80' if current_step > 3 else 'text-white/50' }}">
                    {% if current_step > 3 %}
                    ✓ {{ classroom.surveys.filter_by(is_complete=True).count() if classroom else 0 }}{{ _('명 응답 완료') }}
                    {% elif current_step == 3 %}
                    {{ _('학급 코드') }}({{ classroom.code if classroom else '' }}){{ _('를 학생들에게 공유하세요') }}
                    {% else %}
                    {{ _('학생 등록 후 진행 가능') }}
                    {% endif %}
                </p>
            </div>
            {% if current_step == 3 and classroom %}
            <div class="flex gap-2">
                <button onclick="copyCode('{{ classroom.code }}')" class="glass-btn text-sm">
                    {{ _('코드 복사') }}
                </button>
                {% if not classroom.survey_active %}
                <button onclick="toggleSurvey({{ classroom.id }}, true)" class="glass-btn glass-btn-primary text-sm">
                    {{ _('설문 시작') }}
                </button>
                {% else %}
                <span class="badge badge-success">{{ _('진행중') }}</span>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- 단계 4: 분석 실행 -->
        <div class="flex items-center gap-4 p-4 rounded-xl {{ 'bg-green-500/20 border border-green-500/30' if current_step > 4 else ('bg-primary-500/20 border border-primary-500/30' if current_step == 4 else 'bg-white/5') }}">
            <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 {{ 'bg-green-500' if current_step > 4 else ('bg-primary-500' if current_step == 4 else 'bg-white/20') }}">
                {% if current_step > 4 %}
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                {% else %}
                <span class="text-white font-bold">4</span>
                {% endif %}
            </div>
            <div class="flex-grow">
                <h3 class="font-medium text-white">{{ _('관계 분석 실행') }}</h3>
                <p class="text-sm {{ 'text-green-300/80' if current_step > 4 else 'text-white/50' }}">
                    {% if current_step > 4 %}
                    ✓ {{ _('분석 완료') }}
                    {% elif current_step == 4 %}
                    {{ _('응답 데이터를 분석하여 관계 네트워크를 생성합니다') }}
                    {% else %}
                    {{ _('설문 응답 수집 후 진행 가능') }}
                    {% endif %}
                </p>
            </div>
            {% if current_step == 4 and classroom %}
            <button onclick="runAnalysis({{ classroom.id }})" class="glass-btn glass-btn-primary text-sm">
                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                {{ _('분석 시작') }}
            </button>
            {% endif %}
        </div>
    </div>

    <!-- 도움말 -->
    <div class="mt-8 pt-6 border-t border-white/10">
        <div class="flex items-start gap-3 text-sm text-white/50">
            <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p>
                {{ _('학생들은 학급 코드를 입력하여 설문에 참여할 수 있습니다.') }}
                {{ _('충분한 응답이 수집되면 네트워크 분석을 실행해주세요.') }}
            </p>
        </div>
    </div>
</div>
{% endmacro %}
